<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/mixins/form.js - ember-easy-orm</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/css/lucid.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
            ember-easy-orm
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.0.7</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/ajax", "classes/formComponent", "classes/godForm", "classes/model", "classes/store", "modules/ajax", "modules/form", "modules/mixins", "modules/model", "modules/pagination", "modules/services", "modules/store"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
<div>
    <div id="sidebar">
    <div id="classes">
        <ul id="api-classes" class="nav nav-list">
                <li><a href="../classes/ajax.html">ajax</a></li>
                <li><a href="../classes/formComponent.html">formComponent</a></li>
                <li><a href="../classes/godForm.html">godForm</a></li>
                <li><a href="../classes/model.html">model</a></li>
                <li><a href="../classes/store.html">store</a></li>
        </ul>
    </div>
    </div>
</div>
        </div>
        <div class="span9">
    <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>addon/mixins/form.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
/** 
This module has two mixins: godForm and formComponent, they are used to manage form handler
@module mixins
@submodule form
*/
import Ember from &#x27;ember&#x27;;

/** 
delete object from backend server
@event deleteObject
@param {Object} selectedItem The current selected item
*/
let deleteObject = function (selectedItem){
    if(!this.modelName){
        throw new Error(&#x60;mixin component modelName is invalid: ${this.modelName}&#x60;);
    }
    this.set(&#x27;loading&#x27;, true);
    this.get(&#x27;store&#x27;).deleteRecord(this.get(&#x27;modelName&#x27;), selectedItem).then((data)=&gt;{
        this.set(&#x27;loading&#x27;, false);
        this.send(&#x27;success&#x27;, &#x27;delete&#x27;, data, selectedItem);
    }).catch((reason)=&gt;{
        this.set(&#x27;loading&#x27;, false);
        this.send(&#x27;fail&#x27;, &#x27;delete&#x27;, reason, selectedItem);
    });
};


/** 
godform mixin is used  for data list to create, update and delete children object 
@public
@class godForm
**/
var godForm = Ember.Mixin.create({
    /** 
    @property modelName
    @type String
    */
    modelName: &#x27;&#x27;,
    /** 
    data set, normally array
    @property model 
    @type Object
    */
    model: null,
    /** 
    current selected item
    @property selectedItem
    @type Object
    */
    selectedItem: null,
    /** 
    for modal dialog
    @property modalShow
    @type boolean
    */
    modalShow: false,
    /** 
    ajax fail reason
    @property reason
    @type String
    */
    reason: null,
    /** 
    orm store service
    @property store
    @type Object
    */
    store: Ember.inject.service(),
    actions: {
        /**
        create new record according to modelName
        @event add
        */
        add() {
            this.set(&#x27;modalShow&#x27;, true);
            this.set(&#x27;selectedItem&#x27;, this.get(&#x27;store&#x27;).createRecord(this.get(&#x27;modelName&#x27;)));
        },
        /**
        edit current selected item
        @event edit
        @param {Object} selectedItem
        */
        edit(selectedItem) {
            this.set(&#x27;modalShow&#x27;, true);
            if (!Ember.isNone(selectedItem)) {
                this.set(&#x27;selectedItem&#x27;, selectedItem);
            }
        },
        /**
        cancel current operation
        @event cancel
        */
        cancel(){
            this.set(&#x27;modalShow&#x27;, false);
        },
        /**
        remove current selected item
        @event remove
        @param {Object} selectedItem
        */
        remove(selectedItem){
            deleteObject.call(this, selectedItem);
        },
        /**
        success ajax request success callback
        @event success
        @params {String} action The current operation: create, update, delete
        @params {Object} data The response data from backend server
        @params {Object} selectedItem Thc current selected item
        */
        success(action, data, selectedItem) {
            Ember.Logger.info(&#x27;subclass override this function for response data&#x27;);
            this.set(&#x27;modalShow&#x27;, false);
            if(this.sendAction) {
                this.sendAction(&#x27;success&#x27;, action, data, selectedItem);
            }

            if(!this.model.contains(selectedItem)){
                this.model.insertAt(0, selectedItem);
            }

            if(action === &#x27;delete&#x27;){
                this.model.removeObject(selectedItem);
            }
        },
        /**
        fail ajax request success callback
        @event fail
        @params {string} action The current operation: create, update, delete
        @params {Object} reason The ajax request response
        @params {Object} selectedItem Thc current selected item
        */
        fail(action, reason, selectedItem) {
            Ember.Logger.info(&#x27;subclass override this function for fail request&#x27;);
            this.set(&#x27;reason&#x27;, reason);
            if(this.sendAction) {
                this.sendAction(&#x27;fail&#x27;, action, reason, selectedItem);
            }
        },
    }
});


/** 
formComponent mixin is used for single object form
@public
@class formComponent
**/
var formComponent = Ember.Mixin.create({
    /** 
    @property modelName 
    @type String
    */
    modelName: &#x27;&#x27;,
    /** 
    single object, normally for form 
    @property model 
    @type Object
    */
    model: null,
    /** 
    orm store service
    @property store
    @type Object
    */
    store: Ember.inject.service(),
    /** 
    ajax fail reason
    @property reason
    @type String
    */
    reason: null,
    actions: {
        /**
        save triggle when user click save action
        @event save
        */
        save() {
            if(!this.modelName){
                throw new Error(&#x60;mixin formComponent modelName is invalid: ${this.modelName}&#x60;);
            }
            this.set(&#x27;loading&#x27;, true);
            if (!this.validate()) {return;}
            let primaryKey = this.get(&#x27;store&#x27;).modelFor(this.modelName).primaryKey;
            let actionName = Ember.get(this.model, primaryKey) ? &#x27;update&#x27; : &#x27;create&#x27;;
            this.get(&#x27;store&#x27;).save(this.get(&#x27;modelName&#x27;), this.get(&#x27;model&#x27;)).then((data)=&gt;{
                this.set(&#x27;loading&#x27;, false);
                this.send(&#x27;success&#x27;, actionName, data);
            }).catch((reason)=&gt;{
                this.set(&#x27;loading&#x27;, false);
                this.send(&#x27;fail&#x27;, actionName, reason);
            });
        },

        /**
        delete triggle when user click save action
        @event remove 
        */
        remove() {
            deleteObject.call(this, this.get(&#x27;model&#x27;));
        },

        /**
        success ajax request success callback
        @event succuess  
        @params {String} action The current operation: create, update, delete
        @params {Object} data The response data from backend server
        */
        success(action, data) {
            Ember.Logger.info(&#x27;subclass override this function for response data&#x27;);
            if((action === &#x27;create&#x27;|| action === &#x27;update&#x27;) &amp;&amp; data){
                Ember.setProperties(this.model, data);
            }
            this.sendAction(&#x27;success&#x27;, action, data, this.get(&#x27;model&#x27;));
        },
        /**
        fail ajax request success callback
        @event fail
        @params {string} action The current operation: create, update, delete
        @params {Object} reason The ajax request response
        */
        fail(action, reason) {
            Ember.Logger.info(&#x27;subclass override this function for fail request&#x27;);
            this.set(&#x27;reason&#x27;, reason);
            this.sendAction(&#x27;fail&#x27;, action, reason, this.get(&#x27;model&#x27;));
        },
        /**
        cancel current operation
        @event cancel
        */
        cancel() {
            Ember.Logger.info(&#x27;subclass override this function for form modify cancel&#x27;);
            this.sendAction(&#x27;cancel&#x27;, this.get(&#x27;model&#x27;));
        },
    },
    /**
    validate current model
    @method validate
    @return {Boolean} Returns true when success, false when fails
    */
    validate() {
        Ember.Logger.info(&#x27;subclass override this function for model validate&#x27;);
        return true;
    }
});


export {
    formComponent,
    godForm
};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
